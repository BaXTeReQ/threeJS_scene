"use strict";var scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3);camera.position.set(35,35,-35);var renderer=new THREE.WebGLRenderer;renderer.setClearColor(new THREE.Color(2236962)),renderer.setSize(window.innerWidth,window.innerHeight),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap;var controls=new THREE.OrbitControls(camera,renderer.domElement);document.getElementById("WebGL-output").appendChild(renderer.domElement);var daySpotLight=new THREE.SpotLight(16645075,.5);daySpotLight.position.set(0,100,0),daySpotLight.shadow.mapSize.width=2048,daySpotLight.shadow.mapSize.height=2048,daySpotLight.angle=Math.PI/4,daySpotLight.castShadow=!0,scene.add(daySpotLight);var daySpotLightHelper=new THREE.SpotLightHelper(daySpotLight);scene.add(daySpotLightHelper);var ambientLight=new THREE.AmbientLight(4802889,.5);scene.add(ambientLight);var nightSpotLight=new THREE.SpotLight(10858946,.25);nightSpotLight.position.set(0,-100,0),nightSpotLight.shadow.mapSize.width=2048,nightSpotLight.shadow.mapSize.height=2048,nightSpotLight.angle=Math.PI/4,nightSpotLight.castShadow=!0,scene.add(nightSpotLight);var nightSpotLightHelper=new THREE.SpotLightHelper(nightSpotLight);scene.add(nightSpotLightHelper);var lanternSingle=new THREE.Group,trafficLightSingle=new THREE.Group,lampSingle=new THREE.Group,buildingSingle=new THREE.Group,buildingsGroup=new THREE.Group,tree0Single=new THREE.Group,tree1Single=new THREE.Group,grassGeometry=new THREE.BoxGeometry(1,.1,1),grassMaterial=new THREE.MeshStandardMaterial({color:2600544}),grassBase=new THREE.Mesh(grassGeometry,grassMaterial);grassBase.receiveShadow=!0;for(var grassArray=new Array,i=0;i<5;i++)grassArray[i]=grassBase.clone(),i<2?(grassArray[i].scale.set(25,1,20),grassArray[i].position.set(22.5,0,20),i%2!=0&&grassArray[i].position.set(-22.5,0,20)):(grassArray[i].scale.set(20,1,20),grassArray[i].position.set(-25*i+75,0,-20)),scene.add(grassArray[i]);var sidewalkGeometry=new THREE.BoxGeometry(1,.1,1),sidewalkMaterial=new THREE.MeshStandardMaterial({color:16249315}),sidewalkBase=new THREE.Mesh(sidewalkGeometry,sidewalkMaterial);sidewalkBase.receiveShadow=!0;var sidewalksArray=new Array;for(i=0;i<7;i++)sidewalksArray[i]=sidewalkBase.clone(),i<4?(sidewalksArray[i].scale.set(20,2,5),sidewalksArray[i].rotateY(Math.PI/2),i<2?sidewalksArray[i].position.set(7.5*Math.pow(-1,i),.05,20):sidewalksArray[i].position.set(12.5*Math.pow(-1,i),.05,-20)):i>5?(sidewalksArray[i].scale.set(70,2,5),sidewalksArray[i].position.set(0,.05,-7.5)):(sidewalksArray[i].scale.set(30,2,5),sidewalksArray[i].position.set(20*Math.pow(-1,i),.05,7.5)),scene.add(sidewalksArray[i]);var streetGeometry=new THREE.BoxGeometry(1,.1,1),streetMaterial=new THREE.MeshStandardMaterial({color:3426654}),streetBase=new THREE.Mesh(streetGeometry,streetMaterial);streetBase.receiveShadow=!0;var streetsArray=new Array;for(i=0;i<2;i++)streetsArray[i]=streetBase.clone(),streetsArray[i].scale.set(70,1,10),1==i&&(streetsArray[i].scale.set(10,1,25),streetsArray[i].position.set(0,0,17.5)),scene.add(streetsArray[i]);var lampBaseGeometry=new THREE.CylinderGeometry(1,1,7,32),lampBaseMaterial=new THREE.MeshStandardMaterial({color:9807270}),lampMiddleMaterial=new THREE.MeshStandardMaterial({color:16777215,opacity:.5,transparent:!0}),lampBase=new THREE.Mesh(lampBaseGeometry,lampBaseMaterial),lampMiddle=new THREE.Mesh(lampBaseGeometry,lampMiddleMaterial),lampUpper=new THREE.Mesh(lampBaseGeometry,lampBaseMaterial);lampBase.position.set(0,0,0),lampMiddle.scale.set(1,.2,1),lampMiddle.position.set(0,4.2,0),lampUpper.scale.set(1,.1,1),lampUpper.position.set(0,5.25,0),lampSingle.add(lampBase,lampMiddle,lampUpper);var lampsArray=new Array;for(i=0;i<6;i++){lampsArray[i]=lampSingle.clone(),lampsArray[i].scale.set(.2,.2,.2);for(var j=0;j<3;j++)lampsArray[i].children[j].castShadow=!0,lampsArray[i].children[j].receiveShadow=!0;i<3?lampsArray[i].position.set(12.5,.8,-15-5*i):lampsArray[i].position.set(-12.5,.8,-5*i),scene.add(lampsArray[i])}var lanternBottomGeometry=new THREE.CylinderGeometry(2,5,20,32),lanternBaseGeometry=new THREE.CylinderGeometry(1.5,1.5,100,32),lanternUpperGeometry=new THREE.BoxGeometry(7.5,2,12.5),lanternMaterial=new THREE.MeshStandardMaterial({color:9807270}),lanternBottom=new THREE.Mesh(lanternBottomGeometry,lanternMaterial),lanternBase=new THREE.Mesh(lanternBaseGeometry,lanternMaterial),lanternUpper=new THREE.Mesh(lanternUpperGeometry,lanternMaterial);lanternBottom.position.set(0,1,0),lanternBase.position.set(0,45,0),lanternUpper.position.set(0,96,-5),lanternUpper.rotateX(Math.PI/10);var lanternBulb=new THREE.SpotLight(16777215,.85,0,Math.PI/4,1,1);lanternBulb.castShadow=!0;var lanternLightGeometry=new THREE.BoxGeometry(4,1,9),lanternLightMaterial=new THREE.MeshBasicMaterial({color:16777215,opacity:.5,transparent:!0}),lanternLight=new THREE.Mesh(lanternLightGeometry,lanternLightMaterial);lanternLight.position.set(0,95,-5),lanternLight.rotateX(Math.PI/10),lanternSingle.add(lanternBottom,lanternBase,lanternUpper,lanternLight);var lanternsArray=new Array,lanternsBulbsArray=new Array;for(i=0;i<8;i++){lanternsArray[i]=lanternSingle.clone(),lanternsArray[i].scale.set(.075,.075,.075),lanternsBulbsArray[i]=lanternBulb.clone();for(j=0;j<3;j++)lanternsArray[i].children[j].castShadow=!0,lanternsArray[i].children[j].receiveShadow=!0;i<6?(i%2==0?(lanternsArray[i].position.set(30-10*i,.8,7.5),lanternsBulbsArray[i].position.set(30-10*i,8,7.3),lanternsBulbsArray[i].target.position.set(30-10*i,0,2.3)):(lanternsArray[i].position.set(30-10*i,.8,-7.5),lanternsArray[i].rotateY(Math.PI),lanternsBulbsArray[i].position.set(30-10*i,8,-7.3),lanternsBulbsArray[i].target.position.set(30-10*i,0,-2.3)),i>2&&(lanternsArray[i].translateX(10),lanternsBulbsArray[i].translateX(-10),lanternsBulbsArray[i].target.translateX(-10)),4==i&&lanternsArray[i].position.set(-20,.8,7.5)):7==i?(lanternsArray[i].rotateY(Math.PI/2),lanternsArray[i].position.set(7.5,.8,25),lanternsBulbsArray[i].position.set(7.3,8,25),lanternsBulbsArray[i].target.position.set(2.3,0,25)):(lanternsArray[i].rotateY(-Math.PI*Math.pow(-1,i)/2),lanternsArray[i].position.set(-7.5,.8,15),lanternsBulbsArray[i].position.set(-7.3,8,15),lanternsBulbsArray[i].target.position.set(-2.3,0,15)),scene.add(lanternsArray[i],lanternsBulbsArray[i],lanternsBulbsArray[i].target)}var trafficLightUpperGeometry=new THREE.CylinderGeometry(1.5,1.5,85,32),trafficLightHeadGeometry1=new THREE.CylinderGeometry(5,5,25,32,1,!1,0,3.15),trafficLightHeadGeometry2=new THREE.PlaneGeometry(10,25),trafficLightCylinderGeometry=new THREE.CylinderGeometry(3,3,2,32),trafficLightHeadMaterial=new THREE.MeshStandardMaterial({color:3426654}),trafficLightRedMaterial=new THREE.MeshStandardMaterial({color:16711680,transparent:!0,opacity:.5}),trafficLightYellowMaterial=new THREE.MeshStandardMaterial({color:16776960,transparent:!0,opacity:.5}),trafficLightGreenMaterial=new THREE.MeshStandardMaterial({color:65280,transparent:!0,opacity:.5}),trafficLightBottom=lanternBottom.clone(),trafficLightBase=lanternBase.clone(),trafficLightUpper=new THREE.Mesh(trafficLightUpperGeometry,lanternMaterial),trafficLightHead1=new THREE.Mesh(trafficLightHeadGeometry1,trafficLightHeadMaterial),trafficLightHead2=new THREE.Mesh(trafficLightHeadGeometry2,trafficLightHeadMaterial),trafficLightRed=new THREE.Mesh(trafficLightCylinderGeometry,trafficLightRedMaterial),trafficLightYellow=new THREE.Mesh(trafficLightCylinderGeometry,trafficLightYellowMaterial),trafficLightGreen=new THREE.Mesh(trafficLightCylinderGeometry,trafficLightGreenMaterial);trafficLightBottom.position.set(0,1,0),trafficLightBase.position.set(0,45,0),trafficLightUpper.position.set(0,95,-35),trafficLightUpper.rotateX(Math.PI/2),trafficLightHead1.position.set(-4,88,-60),trafficLightHead2.position.set(-4,88,-60),trafficLightHead2.rotateY(-Math.PI/2),trafficLightSingle.add(trafficLightBottom,trafficLightBase,trafficLightUpper,trafficLightHead1,trafficLightHead2,trafficLightRed,trafficLightYellow,trafficLightGreen);var trafficLightArray=new Array;for(i=0;i<3;i++){var a=0;trafficLightArray[i]=trafficLightSingle.clone(),trafficLightArray[i].scale.set(.075,.075,.075),trafficLightArray[i].position.set(7.5*Math.pow(-1,-i),.8,7.5),trafficLightArray[i].rotateY(-Math.PI-Math.PI*i);for(j=0;j<8;j++)j<5?(trafficLightArray[i].children[j].castShadow=!0,trafficLightArray[i].children[j].receiveShadow=!0):(trafficLightArray[i].children[j].rotateZ(Math.PI/2),trafficLightArray[i].children[j].position.set(-5,96-8*a,-60),a++);i%2==0&&trafficLightArray[i].position.set(7.5,.8,-7.5),2==i&&(trafficLightArray[i].rotateY(-Math.PI/2),trafficLightArray[i].translateX(-15)),scene.add(trafficLightArray[i])}var woodGeometry=new THREE.CylinderGeometry(.5,.5,8,32),woodMaterial=new THREE.MeshStandardMaterial({color:6364416}),woodBase=new THREE.Mesh(woodGeometry,woodMaterial),leavesGeometry0=new THREE.CylinderGeometry(.75,5,4,10),leavesGeometry1=new THREE.CylinderGeometry(.1,5,4,10),leavesMaterial0=new THREE.MeshStandardMaterial({color:2146155}),leavesBase0=new THREE.Mesh(leavesGeometry0,leavesMaterial0),tree0Leaves0=leavesBase0,tree0Leaves1=tree0Leaves0.clone(),tree0Leaves2=tree0Leaves0.clone(),tree0Leaves3=tree0Leaves0.clone(),tree0=[woodBase,tree0Leaves0,tree0Leaves1,tree0Leaves2,tree0Leaves3];tree0[1].position.set(0,-.25,0),tree0[2].scale.set(.75,.75,.75),tree0[2].position.set(0,1.5,0),tree0[3].scale.set(.5,.5,.5),tree0[3].position.set(0,3,0),tree0[4].geometry=leavesGeometry1,tree0[4].scale.set(.375,.5,.375),tree0[4].position.set(0,4.25,0),tree0.forEach(function(e){e.castShadow=!0,e.receiveShadow=!0,tree0Single.add(e)});var tree0Array=new Array;for(i=0;i<3;i++)tree0Array[i]=tree0Single.clone(),scene.add(tree0Array[i]);tree0Array[0].position.set(15,4,15),tree0Array[1].position.set(-15,4,15),tree0Array[2].position.set(-30,4,25);var leavesGeometry2=new THREE.IcosahedronGeometry(3),leavesBase1=new THREE.Mesh(leavesGeometry2,leavesMaterial0),tree1Leaves0=leavesBase1,tree1=[woodBase,leavesBase1];leavesBase1.position.set(0,2.5,0),tree1.forEach(function(e){e.castShadow=!0,e.receiveShadow=!0,tree1Single.add(e)});var tree1Array=new Array;for(i=0;i<7;i++)tree1Array[i]=tree1Single.clone(),tree1Array[i].children[1].rotateY(Math.PI/Math.random()*7+1),scene.add(tree1Array[i]);tree1Array[0].position.set(15,4,25),tree1Array[1].position.set(-25,4,15),tree1Array[2].position.set(-20,4,22.5),tree1Array[3].position.set(-12.5,4,25),tree1Array[4].position.set(-17.5,4,-12.5),tree1Array[5].position.set(17.5,4,-12.5),tree1Array[6].position.set(-7.5,4,-12.5);var wallGeometry0=new THREE.BoxGeometry(10,5,.25),wallGeometry1=new THREE.BoxGeometry(3.5,5,.25),wallGeometry2=new THREE.BoxGeometry(3,1.75,.25),floorGeometry=new THREE.BoxGeometry(9.5,.25,9.5),windowGeometry=new THREE.BoxGeometry(3,1.5,.05),roofGeometry=new THREE.BufferGeometry,vertices=new Float32Array([5.5,2.5,5,0,6.25,5,-5.5,2.5,5,5.5,2.5,5,5.5,2.5,-5,0,6.25,-5,5.5,2.5,5,0,6.25,-5,0,6.25,5,-5.5,2.5,5,0,6.25,5,0,6.25,-5,-5.5,2.5,5,0,6.25,-5,-5.5,2.5,-5,-5.5,2.5,-5,0,6.25,-5,5.5,2.5,-5,-5.5,2.5,5,5.5,2.5,-5,5.5,2.5,5,-5.5,2.5,-5,5.5,2.5,-5,-5.5,2.5,5]);roofGeometry.setAttribute("position",new THREE.BufferAttribute(vertices,3)),roofGeometry.computeVertexNormals();var floorMaterial=new THREE.MeshStandardMaterial({color:16249315}),windowMaterial=new THREE.MeshStandardMaterial({color:8312543,transparent:!0,opacity:.3}),wallMaterials=[new THREE.MeshStandardMaterial({color:6843872}),new THREE.MeshStandardMaterial({color:15044134}),new THREE.MeshStandardMaterial({color:7151951}),new THREE.MeshStandardMaterial({color:8425115})],roofMaterials=[new THREE.MeshStandardMaterial({color:16729943}),new THREE.MeshStandardMaterial({color:795745}),new THREE.MeshStandardMaterial({color:16351057}),new THREE.MeshStandardMaterial({color:4047315})],wall0=new THREE.Mesh(wallGeometry0,wallMaterials[0]),wall1=new THREE.Mesh(wallGeometry1,wallMaterials[0]),wall2=wall1.clone(),wall3=new THREE.Mesh(wallGeometry2,wallMaterials[0]),wall4=wall1.clone(),wall5=wall1.clone(),wall6=wall3.clone(),wall7=wall3.clone(),wall8=wall1.clone(),wall9=wall1.clone(),wall10=wall3.clone(),wall11=wall3.clone(),floor0=new THREE.Mesh(floorGeometry,floorMaterial),floor1=floor0.clone(),window0=new THREE.Mesh(windowGeometry,windowMaterial),window1=window0.clone(),roof0=new THREE.Mesh(roofGeometry,roofMaterials[0]);wall0.position.set(0,0,-4.875),wall1.position.set(3,0,4.875),wall2.position.set(-3,0,4.875),wall3.position.set(0,1.625,4.875),wall4.position.set(4.875,0,3.25),wall5.position.set(4.875,0,-3.25),wall6.position.set(4.875,-1.625,0),wall7.position.set(4.875,1.625,0),wall8.position.set(-4.875,0,3.25),wall9.position.set(-4.875,0,-3.25),wall10.position.set(-4.875,-1.625,0),wall11.position.set(-4.875,1.625,0),floor0.position.set(0,-2.375,0),floor1.position.set(0,2.375,0),window0.position.set(4.875,0,0),window1.position.set(-4.875,0,0),buildingSingle.add(wall0,wall1,wall2,wall3,wall4,wall5,wall6,wall7,wall8,wall9,wall10,wall11,window0,window1,floor0,floor1,roof0);var buildingArray=new Array;for(i=0;i<4;i++){buildingArray[i]=buildingSingle.clone(),buildingArray[i].position.set(25*i-25,2.5,-20),3==i&&(buildingArray[i].position.set(25,2.5,20),buildingArray[i].rotateY(Math.PI));for(j=0;j<17;j++)j>3&&j<15&&buildingArray[i].children[j].rotateY(Math.PI/2),buildingArray[i].children[j].castShadow=!0,buildingArray[i].children[j].receiveShadow=!0,j<12&&(buildingArray[i].children[j].material=wallMaterials[i]),16==j&&(buildingArray[i].children[j].material=roofMaterials[i]),j>11&&j<13&&(buildingArray[i].children[j].castShadow=!1,buildingArray[i].children[j].receiveShadow=!1);scene.add(buildingArray[i])}function animate(){requestAnimationFrame(animate),daySpotLight.position.x=100*Math.sin(Date.now()/4800),daySpotLight.position.y=100*Math.cos(Date.now()/4800),nightSpotLight.position.x=-100*Math.sin(Date.now()/4800),nightSpotLight.position.y=-100*Math.cos(Date.now()/4800),daySpotLight.position.y<70&&daySpotLight.position.x>0&&(daySpotLight.intensity-=.002,(daySpotLight.intensity<9e-4||daySpotLight.position.y<-20)&&(daySpotLight.intensity=0),lanternsOn(daySpotLight.position.y)),daySpotLight.position.y>-20&&daySpotLight.position.x<0&&(daySpotLight.intensity+=.002,daySpotLight.intensity>.499&&(daySpotLight.intensity=.5),lanternsOff(daySpotLight.position.y)),daySpotLight.position.y<-10&&(daySpotLight.intensity=0),nightSpotLight.position.y<70&&nightSpotLight.position.x>0&&(nightSpotLight.intensity-=.001,(nightSpotLight.intensity<9e-4||nightSpotLight.position.y<-20)&&(nightSpotLight.intensity=0)),nightSpotLight.position.y>-20&&nightSpotLight.position.x<0&&(nightSpotLight.intensity+=.001,nightSpotLight.intensity>.249&&(nightSpotLight.intensity=.25)),nightSpotLight.position.y<-10&&(nightSpotLight.intensity=0),controls.update(),renderer.render(scene,camera)}function lanternsOff(e){lanternsBulbsArray.forEach(function(t){t.intensity<=.01225||e>10?t.intensity=0:t.intensity-=.01225}),lanternsArray.forEach(function(e){e.children[3].material.opacity<=.1?e.children[3].material.opacity=.1:e.children[3].material.opacity-=.00225})}function lanternsOn(e){lanternsBulbsArray.forEach(function(t){t.intensity>=.84||e<-20?t.intensity=.85:t.intensity+=.01225}),lanternsArray.forEach(function(e){e.children[3].material.opacity>=1?e.children[3].material.opacity=1:e.children[3].material.opacity+=.00225})}renderer.render(scene,camera),animate();